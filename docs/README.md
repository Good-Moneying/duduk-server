## 기능 명세서

### 유저

**유저 생성**

- [x]  카카오로 처음 로그인한 경우 온보딩 과정을 진행한다
- [x]  가입 여부에 따라 true, false를 반환한다
- [x]  유저는 닉네임, 성별, 생년월일, **관심사(카테고리)**, 목표 설정을 입력하여 생성할 수 있다
- [x]  닉네임은 2자 이상 10자 이하로 작성해야 한다
- [x]  닉네임과 이메일은 다른 유저와 중복될 수 없다
- [x]  성별은 남자/여자 중 하나를 선택한다
- [x]  생년월일은 년/월/일 형태로 입력되어야 한다

**유저 알람**

- [ ]  온보딩 시 등록했던 관심사를 기반으로 맞춤형(추천) 뉴스 레터를 푸쉬 알람으로 전송한다
    - [ ]  헤드라인 혹은 “뉴스레터가 도착했습니다” 등의 문구를 전송한다
    - [ ]  푸쉬 알람은 유저가 설정한 시간으로 전송한다
- [ ]  온보딩 시 등록했던 목표보다 참여율이 낮을 경우 푸쉬 알람을 전송한다
- [ ] 현재 주의 월요일 ~ 일요일 까지의 참여율을 계산한다
- [ ] 만약 목표했던 참여율보다 낮다면 푸쉬 알람을 전송한다
- [ ] 푸쉬 알림 테이블에 저장한 뒤, 배치로 지정한 시간에 알람을 보낸다

[//]: # (todo: 알람 테이블 추가하기 &#40;tb_notification&#41;)

### 홈
- [ ]  오늘의 두둑에는 에디터의 뉴스레터를 보여준다
- [ ]  해당 뉴스레터는 오늘 등록한 뉴스레터를 보여준다
- [ ]  오늘의 단어는 오늘의 두둑과 마찬가지로 에디터가 직접 작성한다
- [ ]  오늘의 단어와 오늘의 두둑은 오늘 날짜를 기준으로 조회한다
- [ ]  실시간 트렌드 뉴스는 매 정각마다 크롤링한 뉴스로 대체한다 
- [ ]  실시간 트렌드 뉴스는 3개의 뉴스 레터를 전달한다
- [ ]  추천 콘텐츠는 사용자의 관심사를 기반으로 추천한다 
- [ ]  추천 콘텐츠는 3개의 뉴스레터를 전달한다

### 뉴스레터

**에디터 뉴스레터 생성**

- [x]  에디터는 썸네일, 헤드라인, 본문, 키워드, **카테고리(관심사)** 등을 입력하여 뉴스레터를 작성한다
- [x]  에디터 권한이 있는 유저만 뉴스레터를 작성할 수 있다
- [x]  에디터 권한은 ROLE_ADMIN, ROLE_EDITOR이다.
- [ ]  에디터 본인이 작성한 뉴스레터에 대해 단어 하이퍼링크를 등록할 수 있다
- [ ]  에디터 뉴스레터 헤드라인은 공백 포함 50자 미만이다
- [ ]  에디터 뉴스레터 본문은 2000자를 넘을 수 없다
- [ ]  뉴스레터 키워드는 최대 5개까지 등록 가능 하다

**에디터 뉴스레터 조회**

- [x]  오늘의 뉴스레터을 조회 한다
  - [x]  날짜 (오늘)와 타입 (에디터)를 필터링 하여 뉴스 레터를 조회 한다
- [ ]  오늘의 단어를 조회 한다
  - [ ]  날짜 (오늘)를 기준으로 필터링 하여 단어를 조회 한다
- [ ]  실시간 트렌드 뉴스를 조회한다
  - [ ]  가장 최근에 조회된 3 개의 뉴스와 타입 (AI)를 필터링 하여 뉴스 레터를 조회 한다
- [ ]  추천 콘텐츠를 조회한다
  - [ ]  사용자의 Category를 기준으로 필터링 하여 뉴스 레터를 조회 한다
  - [ ]  조회 수가 가장 높은 순으로 조회 한다
- [ ]  뉴스레터 클릭 시 뉴스레터의 상세 내용을 확인할 수 있다
- [ ]  뉴스레터 상세 내용은 헤드라인, 본문, 썸네일, 키워드, 카테고리 정보를 확인할 수 있다
- [ ]  뉴스레터 상세 내용은 댓글을 확인할 수 있다
- [ ]  뉴스레터 상세 내용은 스크랩 여부를 확인할 수 있다
- [ ]  뉴스레터 상세 내용은 스크랩한 유저의 수를 확인할 수 있다
- [ ]  하나의 뉴스레터에 키워드는 최대 3개까지 보여진다
- [ ]  뉴스레터 클릭 시 조회수가 증가한다
- [ ]  뉴스레터 스크랩 시 스크랩 수가 증가한다
- [ ]  사용자의 댓글 작성 여부를 확인한다
  - [ ]  findCommentByUserIdAndNewsLetterId() 메서드를 통해 사용자의 댓글을 확인한다
  - [ ]  없다면 false 값을 반환한다 

**에디터 뉴스레터 수정**

- [ ]  본인이 작성한 뉴스레터만 수정이 가능하다
- [ ]  헤드라인, 본문, 썸네일, 키워드, 카테고리 정보를 수정 가능하다

**에디터 뉴스레터 삭제**

- [x]  본인이 작성한 뉴스레터만 삭제가 가능하다
- [x] 본인이 작성하지 않는 뉴스레터를 삭제하려고 하는 경우 예외를 발생한다
- [ ]  삭제 시 해당 뉴스레터를 스크랩한 모든 유저에게서 해당 뉴스레터를 제거한다

**AI 뉴스레터 생성**

- [ ]  매일 새벽에 네이버 뉴스(미정)를 크롤링 한다 (리프레시는 최대한 짧게)
- [ ]  카테고리(관심사) 별 상위 5개의 뉴스를 크롤링 한다
- [ ]  뉴스 내용을 API(네이버 클로바, Open AI)를 통해 뉴스레터 본문으로 정제한다
    - [ ]  본문 내용은 네이버 클로바 **프롬프트 엔지니어링을 통해 한번 더 가공**한다
    - [ ]  정제한 뉴스레터 본문을 데이터 베이스에 저장한다
    - [ ]  AI 뉴스레터 본문은 2000자를 넘을 수 없다
- [ ]  정제된 뉴스 본문을 통해 경제 정보를 추출한다
    - [ ]  경제 정보는 관련 주식, 환율, 코인, 경제 지수 등이 존재한다
    - [ ]  경제 정보를 데이터 베이스에 저장한다
- [ ]  카테고리는 온보딩 시 사용자가 지정했던 관심사와 동일하다
    - [ ]  사용자의 관심사와 동일한 뉴스는 별도의 메세지 큐로 전송한다
- [ ] 썸네일 정보가 없다면 관심사 별 샘플 데이터를 랜덤으로 매핑한다

[//]: # (todo: 알람 테이블 추가하기 &#40;tb_notification&#41;)

**뉴스레터 세줄 요약**

- [ ]  네이버 클로바 summary를 활용해서 에디터 뉴스레터를 3줄 요약한다.
- [ ]  네이버 클로바 summary를 활용해서 AI 뉴스레터를 3줄 요약한다.
- [ ]  summary request 설정 값을 model = news, tone = 2, summaryCount = 3 으로 한다.
- [ ]  관심사 별로 요약한 정보를 데이터 베이스에 저장한다.

**뉴스레터 코멘트**

- [ ]  사용자는 뉴스레터에 코멘트를 남기면 다른 사람의 코멘트를 확인할 수 있다
- [ ]  코멘트의 글자 수는 300자 제한이다

### 아카이브 

- [x]  사용자는 북마크를 통해 뉴스레터를 아카이브 할 수 있다
- [x]  아카이브 된 뉴스레터는 카테고리 별로 분류된다
  - [x] 카테고리는 금융, 부동산, 증권, 정책 등이 있다 

### 단어장

**단어장 생성**

- [ ]  관리자는 단어장을 추가할 수 있다
- [ ]  단어장은 단어, 영단어, 설명으로 구성되어 있다
- [ ]  단어 설명은 300자를 넘어갈 수 없다
- [ ]  단어는 사용자의 아카이브와 일대다 관계이다

**단어장 수정**

- [ ]  관리자만 단어장을 수정할 수 있다

**단어장 삭제**

- [ ]  관리자만 단어장을 삭제할 수 있다

## 기술적 논의 사항

Q. 성공적으로 로그인 했다면 이벤트를 발행하는건 어떨까? 
로그인 시 처리해야 하는 많은 일들을 OAuthService에서 처리하기에는 많은 의존성이 필요하다.

- 로그인 시 refreshToken 업데이트
- 로그인 시 유저 정보 업데이트 (출석 체크, 도토리 지급) 
- 출석 체크 용 테이블을 생성한다